# Redis的事件处理机制

Redis服务器是一个事件驱动程序，服务器需要处理以下两类事件：

**文件事件**：Redis服务器通过套接字与客户端进行连接，文件事件就是对套接字操作的抽象。

**时间事件**：Redis服务器中的一些操作（比如serverCron函数）需要在给定时间执行，时间事件就是对这类定时操作的抽象。

## 文件事件

Redis基于Reactor模式开发了自己的网络事件处理器，这个处理器被称为文件事件处理器：

1. 文件事件处理器使用I/O多路复用程序来同时监听多个套接字，并根据套接字目前执行的任务来为关联不同的事件处理器。
2. 当被监听的套接字准备好执行应答（accept）、读取（read）、写入（write）、关闭（close）等操作时，与操作相对应的文件事件就会产生，这时文件事件处理器就会调用套接字之前关联好的事件处理器来处理这些事件。

虽然文件事件处理器以单线程方式运行，但通过使用I/O多路复用程序来监听多个套接字，文件事件处理器既实现了高性能的网络通信模型，又可以很好地与Redis服务器中其他同样以单线程运行的模块进行对接，这保证了Redis内部单线程设计的简单性。

文件事件处理器由四部分构成：
套接字->I/O多路复用程序->队列->文件事件分派器->事件处理器。

事件处理器：连接应答处理器、命令请求处理器、命令回复处理器。

事件类型：当套接字变得可读时产生或者有新得可应答套接字，产生AE_READABLE事件；当套接字变得可写时，产生AE_WRITABLE事件。

## 时间事件

时间事件分为周期性和定时时间事件。

实现：服务器将所有时间事件都放在一个无序链表中，每当时间事件执行器运行时，它就遍历整个链表，查找所有到达得时间事件，并调用相应得事件处理器。